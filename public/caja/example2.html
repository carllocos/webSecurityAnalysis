<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <title>Network disabled example</title>

    <!-- Load required caja module-->
    <script type="text/javascript" src="http://caja.appspot.com/caja.js">
    </script>

</head>

<body>
    <h1>Network disabled</h1>
    <p>In this example, the guest code checks the password strength and provides feedback to the user. The guest code also attempts an unauthorised network request to send the password to its server</p>
    <form id="form" class="" action="" method="post">
        <label>Password</label>
        <br>
        <input type="text" id="pswd" name="" value="" placeholder="the guest verifies this password">
        <br>
        <small id="feedback">guest inserts feedback here</small>
        <br>
        <button id="btn">verify</button>
        <br>
        <small id="backend"></small>
    </form>

    <!-- Example with Caja. Comment Script to disable Caja -->
    <script type="text/javascript">
        //disable of default click behaviour on form
        document.getElementById("form").addEventListener("click", (ev) => { ev.preventDefault() })

        caja.whenReady(function (ev) { console.log("Ready!") })
        caja.initialize({
            cajaServer: 'http://caja.appspot.com/',
            debug: true
        })


        const NO_NETWORK = undefined;
        const NO_EMBED = undefined;
        const guestURL = 'http://localhost:3030/example2_guest.js'
        caja.load(NO_EMBED, NO_NETWORK, (frame) => {

            var listener;
            var pswdService = {
                register: (l) => {
                    listener = l;
                },
                feedback: (fb) => {
                    document.getElementById("feedback").innerHTML = fb
                }
            }

            caja.markReadOnlyRecord(pswdService);
            caja.markFunction(pswdService.register);
            caja.markFunction(pswdService.feedback);
            var tamedService = caja.tame(pswdService);


            document.getElementById("btn").addEventListener("click", () => {
                var content = { pswd: document.getElementById("pswd").value };
                caja.markReadOnlyRecord(content);
                listener(content);
            })


            frame.code(guestURL, 'application/javascript')
                .api({ pswdService: tamedService })
                .run();
        })
    </script>

    <!-- Behaviour without Caja. Uncomment and comment previous script to trigger -->
    <!-- <script>
        document.getElementById("form").addEventListener("click", (ev) => { ev.preventDefault() })
        var listener;
        var pswdService = {
            register: (l) => { listener = l },
            feedback: (fb) => { document.getElementById("feedback").innerHTML = fb }
        }
        document.getElementById("btn").addEventListener("click", () => {
            var content = { pswd: document.getElementById("pswd").value };
            listener(content);
        })
    </script>
    <script src='http://localhost:3030/example2_guest.js'></script> -->
</body>

</html>